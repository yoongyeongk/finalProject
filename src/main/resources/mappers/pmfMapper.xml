<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="pmfMapper">
  	
  	<resultMap type="PmfBoardDTO" id="viewResult">
  		<id property="num" column="num"/>
  		<collection property="fileDTO" column="num" ofType="FileDTO" select="selectFile">
  			<id property="fnum" column="fnum"/>
  		</collection>
  		<collection property="pmfDocumentDTO" column="num" ofType="pmfDocumentDTO" select="selectDocument">
  			<id property="docu_num" column="docu_num"/>
  		</collection>
  	</resultMap>
  	
  	<select id="selectList" parameterType="RowNum" resultType="PmfBoardDTO">
  		select * from
  		(select rownum r, N.* from
  		(select * from pmf_board order by num desc) N)
  		where r between 1 and 10
  	</select>
  	
  	<!-- view에 필요한 내용들 불러오기 -->
  	<select id="selectOne" parameterType="int" resultMap="viewResult">
  		select * from pmf_board where num=#{num}
  	</select>
  	
  	<!-- 파일 -->
  	<select id="selectFile" parameterType="int" resultType="FileDTO">
  		select * from pmf_files where num=#{num}
  	</select>
  	
  	<!-- 문서 -->
  	<select id="selectDocument" parameterType="int" resultType="com.hi.project.pmf.PmfDocumentDTO">
  		select * from pmf_document where num=#{num}
  	</select>
  	
  	<update id="hitUpdate" parameterType="int">
  		update pmf_board set hit=hit+1 where num=#{num}
  	</update>
  	<!-- 여기까지 -->
  	
  	
  	<insert id="insert" parameterType="PmfBoardDTO">
  		<selectKey keyProperty="num" resultType="int" order="BEFORE">
  			select pmf_board_seq.nextval from dual
  		</selectKey>
  		insert into pmf_board 
  		values(#{num},#{title},#{writer},sysdate,0,
  			   #{major_key},#{sub_key},#{works},#{project_name},#{start_date},#{end_date},#{project_detail},
  			   #{work_kind},#{education_level},#{career},#{payment_kind},#{payment_value},
  			   #{firm_info},#{addr},#{addr_detail},
  			   #{admin_id},#{admin_email},#{admin_phone},
  			   #{duration_kind},#{duration_end},#{temp})
  	</insert>
  	
  	<select id="getTotalCount" parameterType="RowNum" resultType="int">
  		select count(*) from pmf_board
  		<if test="kind == '전체'">
  		</if>
  		<if test="kind == '제목'">
  			where title like '%'||#{search}||'%'
  		</if>
  		<if test="kind == '프로젝트 유형'">
  			where major_key like '%'||#{search}||'%' or sub_key like '%'||#{search}||'%'
  		</if>
  	</select>
  	
  	<select id="selectMajorKeys" resultType="java.lang.String">
  		select distinct(major_key) from pmf_key_value ORDER BY major_key
  	</select>
  	
  	<select id="selectSubKeys" parameterType="java.lang.String" resultType="java.lang.String">
  		select sub_key from pmf_key_value where major_key=#{major_key}  order by sub_key
  	</select>
  </mapper>